---
import Layout from '../layouts/Layout.astro';
import "../styles/global.css";
---

<Layout>
    <div class="bg">
		<form method="post" class="initial_forms">
			<h1 class="initial_titles">Inicio de sesion</h1>
			<input class="initial_inputs" name="username" type="text" placeholder="Nombre de usuario">
			<input class="initial_inputs" name="password" type="password" placeholder="contrasenia">
			<button class="initial_buttons" type="submit">Iniciar Sesion</button>
      		<a class="link_create" href="/create-account">No tienes una cuenta?, REGISTRATE</a>
        </form>
	</div>
</Layout>

<script>
const form = document.querySelector('form');

if (form) { 
    form.addEventListener('submit', async (event) => {
        event.preventDefault();

        const formData = new FormData(form)
        const data = new URLSearchParams();
        for (const pair of formData) {
            data.append(pair[0], pair[1].toString());
        }

        try {
            const response = await fetch(new URL('http://localhost:8081/create-user'), {
                method: 'POST',
                mode: 'no-cors',
                body: data,
            });
            console.log(await response.json())
            if (response.ok) {
                const result = await response.json();
                window.location.href = '/login'
                form.reset();
            } else {
                const error = await response.json();
                throw new Error(error.message || 'Error al enviar el formulario');
            }
        } catch {
        }
    });
}
</script>
